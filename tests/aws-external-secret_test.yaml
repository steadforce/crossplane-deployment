suite: test if the settings for the aws-external-secret are correct
capabilities:
  apiVersions:
  - external-secrets.io/v1/ExternalSecret
release:
  name: external-secrets
templates:
- templates/aws-external-secret.yaml
tests:
- it: snapshot test for detecting side effects on aws-external-secret during local development
  asserts:
  - matchSnapshot: {}
- it: target secret name is set to the name of aws secret
  asserts:
  - equal:
      path: spec.target.name
      value: aws
- it: refresh interval is set to one hour
  asserts:
  - equal:
      path: spec.refreshInterval
      value: 1h
- it: secret store reference is set to awssm-parameter-store
  asserts:
  - equal:
      path: spec.secretStoreRef
      value:
        kind: ClusterSecretStore
        name: awssm-parameter-store
- it: data for local cluster is referencing the correct key(s)
  values:
  - ../values-subchart-overrides.yaml
  - ../values-local.yaml
  asserts:
  - equal:
      path: spec.data
      value:
      - secretKey: creds
        remoteRef:
          key: /local/crossplane/aws
- it: data for development cluster is referencing the correct key(s)
  values:
  - ../values-subchart-overrides.yaml
  - ../values-development.yaml
  asserts:
  - equal:
      path: spec.data
      value:
      - secretKey: creds
        remoteRef:
          key: /development/crossplane/aws
- it: data for production cluster is referencing the correct key(s)
  values:
  - ../values-subchart-overrides.yaml
  - ../values-production.yaml
  asserts:
  - equal:
      path: spec.data
      value:
      - secretKey: creds
        remoteRef:
          key: /production/crossplane/aws
